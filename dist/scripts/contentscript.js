"use strict";function makeData(){if("qq"===platform){if($(".chat_content:last img").length)var a=$(".chat_content:last").html();else var a=$(".chat_content:last").text();var b="",c={id:a,user:{name:$(".chat_content_group:last .chat_nick").text(),avatar:$(".chat_content_group:last .chat_content_avatar").attr("src")},time:$(".chatItem:last .time").text().trim(),msg:{text:a,image:b}}}else if("wx"===platform){if($(".chatItemContent:last pre img").length){$(".chatItemContent:last pre img").each(function(){var a=$(this).attr("src");$(this).attr("src","https://wx.qq.com"+a)});var a=$(".chatItemContent:last pre").html()}else var a=$(".chatItemContent:last pre").text();if($(".chatItemContent:last .img_wrap img").length)var b="https://wx.qq.com"+$(".chatItemContent:last .img_wrap img").attr("src");else if($(".chatItemContent:last .customEmoji").length)var b="https://wx.qq.com"+$(".chatItemContent:last .customEmoji").attr("src");else var b="";var c={id:$(".chatItem:last").attr("un"),user:{name:$(".chatItemContent:last .avatar").attr("title"),avatar:"https://wx.qq.com"+$(".chatItemContent:last .avatar").attr("src")},time:$(".chatItem:last .time").text().trim(),msg:{text:a,image:b}}}return c}function notifyMe(a){if(!Notification)return void alert("Please us a modern version of Chrome, Firefox, Opera or Firefox.");"granted"!==Notification.permission&&Notification.requestPermission();var b=new Notification(a.msg.text,{icon:a.user.avatar,body:a.msg.test});setTimeout(function(){b.close()},1e4)}function shoot(a){$danmuItem=$("<div>"+a+"</div>").addClass("weshoot-item").addClass("default"),$danmuItem.hide().appendTo("body"),$danmuItem.css({"font-size":~~(10*Math.random())+18}),$danmuItem.css({top:~~(Math.random()*HEIGHT)-$danmuItem.height(),left:WIDTH+$danmuItem.width(),color:"#"+Math.floor(16777215*Math.random()).toString(16),width:$danmuItem.width()}).show(),$danmuItem.animate({left:-$danmuItem.width()},~~(15*Math.random())+15e3,"linear",function(){-$(this).css("left").slice(0,-2)-100<=$danmuItem.width()&&$(this).remove()})}if("w.qq.com"===location.host)var platform="qq";else if("wx.qq.com"===location.host)var platform="wx";else platform="other";var msg={id:"",user:{name:"",avatar:""},time:"",msg:{text:"",image:""}};if("wx"===platform)$("#chatMainPanel").bind("DOMNodeInserted DOMNodeRemoved",function(){var a=makeData();a.id&&a.id!==msg.id&&(console.log(a),chrome.runtime.sendMessage(a,function(a){console.log(a)}),msg=a)});else if("qq"===platform)$("body").bind("DOMNodeInserted DOMNodeRemoved",function(){var a=makeData();a.id&&a.id!==msg.id&&(console.log(a),chrome.runtime.sendMessage(a,function(a){console.log(a)}),msg=a)});else if("other"===platform){console.log("WeShoot ready!"),chrome.runtime.onMessage.addListener(function(a,b,c){console.log(a),shoot(a.msg.text?a.msg.text:'<img src="'+a.msg.image+'" />'),c({status:"OK"})});var danmus=["呜呜呜呜","呵呵","你和","sef","都等了多久多久多久","坑爹坑爹的","对对对","到底"],HEIGHT=window.innerHeight,WIDTH=window.innerWidth,danmuTop,danmuRight,danmuWidth,$danmuItem}